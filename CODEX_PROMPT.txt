ЗАДАЧА: Настроить CORS на Node.js сервере Express, исправить синтаксическую ошибку в файле index.js и перезапустить сервер через PM2

КОНТЕКСТ ПРОЕКТА:
- Проект: VAPC Site - React фронтенд с Node.js бэкендом на Beget VPS
- Сервер: 45.141.76.200
- Пользователь: root
- SSH доступ: парольный (пароль: R9AuQIMM&gt&)
- Путь к серверу: /var/www/server
- Основной файл: /var/www/server/index.js
- Порт: 8080
- Менеджер процессов: PM2
- Имя процесса: vapc

ТЕКУЩИЙ СТАТУС:
✅ Пакет cors установлен (npm install cors выполнен)
❌ Сервер не запускается из-за синтаксической ошибки в строке 3 файла index.js
❌ Файл index.js поврежден - строка 3 содержит некорректный синтаксис

ДЕТАЛИ ОШИБКИ:
Файл: /var/www/server/index.js
Строка: 3
Текущее содержимое: const cors = require(" cors);
Ожидаемое содержимое: const cors = require("cors");
Ошибка: SyntaxError: Invalid or unexpected token
Местоположение ошибки: const cors = require(" cors);
                                    ^^^^^^^^

ЧТО НУЖНО СДЕЛАТЬ:
1. Подключиться к серверу по SSH (root@45.141.76.200)
2. Исправить строку 3 в /var/www/server/index.js - заменить поврежденную строку на правильную
3. Добавить конфигурацию CORS после строки 'const app = express();'
4. Проверить синтаксис файла
5. Перезапустить сервер через PM2
6. Проверить работу CORS через curl запрос

КОНФИГУРАЦИЯ CORS:
Разрешенные origin:
- https://vasinayw.beget.app
- https://va-pc.ru
- http://localhost:3000
- http://127.0.0.1:3000

Параметры:
- credentials: true
- methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS']
- allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With']
- Обработка preflight: app.options('*', cors());

КОД CORS ДЛЯ ДОБАВЛЕНИЯ:
После строки 'const app = express();' добавить:

// ============================================
// CORS НАСТРОЙКА
// ============================================
app.use(cors({
  origin: [
    'https://vasinayw.beget.app',
    'https://va-pc.ru',
    'http://localhost:3000',
    'http://127.0.0.1:3000'
  ],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With']
}));

// Обработка preflight запросов
app.options('*', cors());

СТРУКТУРА ФАЙЛА:
Текущие первые строки /var/www/server/index.js:
const express = require('express');
const db = require('./db')
const cors = require(" cors);  // <-- ПОВРЕЖДЕНА, нужно исправить
const bodyParser = require('body-parser');
...
const app = express();  // <-- После этой строки добавить CORS конфигурацию

ПРЕДЫДУЩИЕ ПОПЫТКИ:
Проблема: Проблемы с экранированием символов при работе через SSH из PowerShell на Windows
Неудачные подходы:
- sed команды с различными вариантами экранирования
- awk команды с многоуровневым экранированием
- Python скрипты через SSH
- Heredoc через SSH

Рекомендация: Использовать простые команды sed/awk напрямую на сервере или создать временный скрипт на сервере

ШАГИ ПРОВЕРКИ:
1. Проверить синтаксис: node -c /var/www/server/index.js
2. Проверить статус PM2: pm2 status
3. Перезапустить: pm2 restart vapc
4. Проверить логи: pm2 logs vapc --lines 10
5. Проверить CORS: curl -I -X OPTIONS http://localhost:8080/getProducts/ -H 'Origin: http://localhost:3000' -H 'Access-Control-Request-Method: GET'

ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:
- ✅ Синтаксис корректен!
- PM2 статус: online
- CORS заголовки присутствуют (Access-Control-Allow-Origin, Access-Control-Allow-Credentials, Access-Control-Allow-Methods)
- Сервер отвечает на запросы без ошибок

ИНСТРУКЦИЯ:
Выполни задачу ПОЛНОСТЬЮ: подключись к серверу по SSH, исправь файл, добавь CORS конфигурацию, проверь синтаксис, перезапусти сервер и убедись что всё работает. Используй простые команды sed/awk или создай временный скрипт на сервере для избежания проблем с экранированием.

